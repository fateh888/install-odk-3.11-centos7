**Please do use a clean CentOS system, the script installs all necesary tools and packages including Ansible, container runtime, etc.**

> **Warning about Let's Encrypt setup available on this project:**
> Let's Encrypt only works if the IP is using publicly accessible IP and custom certificates."
> This feature doesn't work with OpenShift CLI for now.

## Installation

1. Create a VM with as descrption below:-

```
#create a centos 7 vm with 50GB storage and 4GB RAM. 
#During installation you can provides swap to 5GB and 45GB to / 
#setup the network config with <hostname>.<ip(it can be your private network ip)>.nip.io for example: master.192.168.0.50.nip.io
#if your vm have issue with internet connectivity, update the /etc/resolv.conf file with servername 8.8.8.8
```

#vi /etc/hosts
```
192.168.0.50   master.192.168.0.50.nip.io master

```
#validate the /etc/hosts file with following commands to make sure all the info are correct.
```
#hostname --short
master
#hostname --domain
192.168.0.50.nip.io
#hostname --fqdn
master.192.168.0.50.nip.io
#hostname --ip-address
192.168.0.50
```
#update /etc/resolve.conf with following info
```
#vi /etc/resolve.conf
#Generated by NetworkManager
search 192.168.0.50.nip.io
nameserver 8.8.8.8
```
#update /etc/hostname with following info
```
#vi /etc/hostname
master.192.168.0.50.nip.io
```
#now perform yum update
```
#yum update -y
```
#Install the git docker and net-tools 
```
#yum install -y git docker net-tools
```

#reboot the system 
```
#reboot
 
```

#update following ENV

```
export DOMAIN=192.168.0.50.nip.io
export USERNAME=master
export PASSWORD=master

```

2. Clone this repo

```
git clone https://github.com/fateh888/install-odk-3.11-centos7.git
cd install-odk-3.11-centos7
./install-openshift.sh
```


3. Define optional variables for the installation process

```
# Instead of using loopback, setup DeviceMapper on this disk.
# !! All data on the disk will be wiped out !!
$ export DISK="/dev/sda"
```

4. Run the automagic installation script as root with the environment variable in place:

```
curl https://github.com/fateh888/install-odk-3.11-centos7/blob/main/install-openshift.sh | INTERACTIVE=false /bin/bash
```

## Development

For development it's possible to switch the script repo

```
# Change location of source repository
$ export SCRIPT_REPO="https://github.com/fateh888/install-odk-3.11-centos7/blob/main/"
$ curl $SCRIPT_REPO/install-openshift.sh | /bin/bash
```

## Testing

The script is tested using the tooling in the `validate` directory.

To use the tooling, it's required to create file `validate/env.sh` with the DigitalOcean API key

```
export DIGITALOCEAN_TOKEN=""
```

and then run `start.sh` to start the provisioning. Once the ssh is connected to the server, the
script will atatch to the `tmux` session running Ansible installer.

To destroy the infrastructure, run the `stop.sh` script.
